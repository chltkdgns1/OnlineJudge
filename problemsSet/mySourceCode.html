<!DOCTYPE html>

<?php
session_start();
if(!$_SESSION['id'] && !$_SESSION['name'] && !$_SESSION['pass']){
  echo("
    <script>
      window.alert('로그인을 해주시고 이용바랍니다.')
      history.go(-1)
    </script>
    ");
  exit;
}

if(empty($_GET['num']) || empty($_GET['pnum'])){
  echo("
    <script>
      window.alert('잘못된 접근입니다.')
      history.go(-1)
    </script>
    ");
  exit;
}

$_SESSION['problem_number'] = $_GET['pnum'];
$num = $_GET['num'];


$DOCUMENT_ROOT = $_SERVER["DOCUMENT_ROOT"];  // 웹 서버의 root 경로

$fp = @fopen("$DOCUMENT_ROOT/pru.txt", "rb");

if(!$fp) {
  echo("
    <script>
      window.alert('액세스 실패하였습니다.')
      history.go(-1)
    </script>
    ");
  exit;
}

$dbpass = "";
while(!feof($fp)) {
  $dbpass = fgets($fp, 999);
}

  $servername="localhost";
  $username="root";
  $dbpasswd=$dbpass;
  $dbname="opent";
  $conn = mysqli_connect($servername,$username,$dbpasswd,$dbname);

  $sql = "SELECT * FROM scoring_status WHERE num = {$num}";
	$result = mysqli_query($conn,$sql);

  if($result == false){
    echo("
      <script>
        window.alert('요청에 실패하였습니다.')
        history.go(-1)
      </script>
      ");
    exit;
  }

  $row = mysqli_fetch_assoc($result);
  $sourcecode = $row['source'];
  $id = $row['id'];

  if(strcmp($id,$_SESSION['id']) == true){
    echo("
      <script>
        window.alert('잘못된 접근입니다.')
        history.go(-1)
      </script>
      ");
    exit;
  }
?>

<html>
<head>
  <script src = "../codemirror/lib/codemirror.js"></script>
  <link  rel = "stylesheet" href = "../codemirror/lib/codemirror.css"/>
  <link  rel = "stylesheet" href = "../codemirror/theme/dracula.css"/>
  <script src = "../codemirror/mode/javascript/javascript.js"></script>
  <script src = "../codemirror/mode/clike/clike.js"></script>
  <script src="../codemirror/addon/edit/matchbrackets.js"></script>
  <script src="../codemirror/addon/edit/closebrackets.js"></script>


  <title>dsa</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../assets/css/main.css" />
  <style type="text/css">

#marginControl
{
  margin:0px 0px 0px 200px; /* 위쪽 오른쪽 아래쪽 왼쪽 마진속성 한번에 주기 */
}

    </style>
</head>
<body class="subpage" id = "marginControl">
        <header id="header">
        <div class="inner">
          <a href="../index.html" class="logo"><strong>Homepage</strong> by 상훈</a>
          <nav id="nav">
            <a href="../index.html">홈</a>
            <a href="../noticeSet/notelist.html">게시판</a>
            <a href="problemsList.html">문제</a>
          </nav>
          <a href="#navPanel" class="navPanelToggle"><span class="fa fa-bars"></span></a>
        </div>
      </header>
  <section id="main" class="wrapper">
    <h3>submit</h3>
                <form method="post" action="Socket.php" enctype="multipart/form-data" >
                    <div class="row uniform">

                      <div class="10u$">
                          <?php echo "<textarea id = 'codemirror' name='demo-codemirror' rows='18'>".$sourcecode."</textarea>" ?>
                          <script>
                            var editor = CodeMirror.fromTextArea(document.getElementById("codemirror"),{
                              mode : "text/x-c++src",
                              theme : "dracula",
                              matchBrackets: true,
                              autoCloseBrackets : true,
                              lineNumbers : true
                            });

                            var mac = CodeMirror.keyMap.default == CodeMirror.keyMap.macDefault;
                            CodeMirror.keyMap.default[(mac ? "Cmd" : "Ctrl") + "-Space"] = "autocomplete";
                          </script>
                      </div>
                      <!-- Break -->
                      <div class="10u$">
                        <ul class="actions">
                          <li><input type="submit" value="수정하기" /></li>
                        </ul>
                      </div>
                    </div>
              </form>
    </section>
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/skel.min.js"></script>
    <script src="../assets/js/util.js"></script>
    <script src="../assets/js/main.js"></script>
</body>
</html>
